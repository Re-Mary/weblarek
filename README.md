# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.


### Данные
Расположение: types/index.ts.
В ходе анализа проекта было установлено: в приложении используются две сущности, которые описывают данные, — товар и покупатель. Их можно описать такими интерфейсами:

#### Интерфейс IProduct
Эта сущность создана для учета товаров в приложении.
```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

#### Интерфейс IBuyer
Эта сущность создана для получения данных пользователя, которые необходимы для заказа товара, его  дальнейшей оплаты и доставки.
```
interface IBuyer {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
} 
```

#### Интерфейс IOrder
Эта сущность создана для получения данных заказа, которые мы отправляем на сервер.
```
interface IOrder {
    payment: TPayment;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[];  //массив id выбранных товаров
}
```

#### Интерфейс IOrderResponse
Эта сущность создана для получения ответ от сервера на создание заказа.
```
interface IOrderResponse {
  id: string; //уникальный идентификатор заказа, назначается сервером
  total: number;  //общая сумма заказа (пересчитана сервером для надёжности)
}
```

### Модели данных
Для учёта данных в приложении должны быть три класса, которые будут разделены между собой по смыслу и зонам ответственности:
- хранение товаров, которые можно купить в приложении
- хранение товаров, которые пользователь выбрал для покупки
- данные покупателя, которые тот должен указать при оформлении заказа
 
#### Класс Products
Отвечает за хранение каталога всех доступных товаров и одного выбранного товара для детального просмотра.

Конструктор класса не принимает параметров. При создании экземпляра инициализируются пустые значения для списка товаров и выбранного товара.

Поля класса:  
`private items: IProduct[]` -  массив объектов товаров. Хранит весь каталог.
`private selectedItem: IProduct | null` -  объект выбранного товара для детального отображения. Если товар не выбран, значение null.

Методы класса:  
`setItems(items: IProduct[]): void` - Сохраняет массив товаров в модель.  
`getItems(): IProduct[]` - Возвращает массив всех товаров.
`getItemById(id: string): IProduct | undefined` -  Принимает id товара и возвращает объект товара или undefined, если товар не найден.
`setSelectedItem(item: IProduct): void` - сохраняет товар для детального отображения.
`getSelectedItem(): IProduct | null` - возвращает товар, сохранённый для подробного отображения. Если товар не выбран, возвращает null.

#### Класс Basket
Отвечает за хранение и управление товарами, которые пользователь добавил в корзину.

Конструктор не принимает параметров. Изначально корзина пуста.

Поля класса:
`private items: IProduct[]` - массив товаров, выбранных покупателем для покупки.

Методы класса:
`getItems(): IProduct[]` - возвращает массив товаров, которые находятся в корзине.
`addItem(item: IProduct): void` - добавляет товар в корзину.
`removeItem(item: IProduct): void` - удаляет товар из корзины (по совпадению id).
`clear(): void` - очищает корзину, удаляя все товары.
`getTotalPrice(): number` - возвращает суммарную стоимость всех товаров в корзине. Если цена у товара null, такие позиции не учитываются.
`getCount(): number` - возвращает количество товаров в корзине.
`hasItem(id: string): boolean` - проверяет, есть ли товар с данным id в корзине. Возвращает true или false.

#### Класс Buyer
Класс Buyer отвечает за хранение и управление данными покупателя, которые тот должен указать при оформлении заказа. Также он реализует валидацию этих данных.

Конструктор:
При создании объекта покупателя:
`payment` инициализируется значением `null`;
`email, phone, address` инициализируются пустыми строками.
Таким образом, данные всегда предсказуемо находятся в начальном состоянии.

Поля класса:
`private payment: TPayment | null` - вид оплаты, выбранный покупателем. Может быть значением перечисления `TPayment `или `null`, если вид оплаты ещё не указан.
`private email: string` - электронная почта покупателя.
`private phone: string` - телефон покупателя.
`private address: string` - адрес покупателя.

Методы класса:
`setPayment(payment: TPayment): void` - устанавливает вид оплаты.
`setEmail(email: string): void` - сохраняет email покупателя.
`setPhone(phone: string): void` - сохраняет телефон покупателя.
`setAddress(address: string): void` - сохраняет адрес покупателя.
`setData(data: Partial<IBuyer>): void` - универсальный метод. Принимает объект, который может содержать одно или несколько полей покупателя, и обновляет только указанные значения.
`getData(): IBuyer` - возвращает объект с актуальными данными покупателя.
`clear(): void` - очищает все данные покупателя (сбрасывает значения в пустые строки или null).
`validate(): <string, string>` - проверяет корректность данных покупателя. Поле является валидным, если оно не пустое. Метод валидации должен давать возможность определить не только валидность каждого отдельного поля, но и предоставлять информацию об ошибке, связанной с проверкой конкретного значения.
Возвращает объект ошибок вида:
```
{
payment: 'Не выбран способ оплаты',
email: 'Укажите email',
}
```
Если поле валидно, то оно не включается в объект ошибок.

### Слой коммуникации
В этом слое описывается взаимодействие с другими приложениями. Для связи приложения с сервером используется отдельный класс, который инкапсулирует работу с API. Он работает поверх класса Api и использует его методы get и post.

#### Класс ShopApi
Этот класс будет использовать композицию, чтобы выполнить запрос на сервер с помощью метода get класса Api и будет получать с сервера объект с массивом товаров.
Класс отвечает за:
- Получение списка товаров с сервера.
- Отправку данных о заказе (покупатель + выбранные товары) на сервер.

Конструктор:
`constructor(private api: IApi)` - принимает аргументом ссылку на экземпляр API. Объект, реализующий интерфейс IApi. 

Методы класса:
`getProducts(): Promise<IProduct[]>` - делает GET запрос на эндпоинт /product/ и возвращает массив товаров.
`createOrder(order: IOrder): Promise<IOrderResponse>` - делает post запрос на эндпоинт /order/ и передаёт в него данные, полученные в параметрах метода.

### Слой представления (View)
Слой View отвечает за визуальное отображение данных и взаимодействие пользователя с интерфейсом.
Компоненты слоя представления не содержат бизнес-логики и не хранят данные — они получают данные от Presenter (через события) и отображают их.
Каждый визуальный компонент реализован в виде отдельного класса, который наследуется от базового класса Component<T>.
Обмен событиями между View и другими слоями приложения осуществляется через объект IEvents.

#### Интерфейс IHeader
Интерфейс описывает структуру данных, используемых компонентом заголовка.
```
interface IHeader {
  counter: number;
}
```
#### Класс HeaderView
Описание:
Класс Header отвечает за отображение и управление заголовком веб-страницы, включая счетчик товаров в корзине и кнопку взаимодействия пользователя.
Класс отвечает за:
- Отображение заголовка страницы.
- Управление счетчиком товаров в корзине.
- Обработку взаимодействий пользователя с кнопкой корзины.

Поля:
`protected counterElement: HTMLElement` - счетчик товаров в корзине
`protected basketButton: HTMLButtonElement` - кнопка взаимодействия пользователя, по нажатию на которую открывается модальное окно с содержимым корзины

Конструктор:
`constructor(protected events: IEvents, container: HTMLElement)` - выполняется поиск необходимых DOM-элементов, регистрируется обработчик клика по кнопке корзины, который инициирует событие State.BASKET_OPEN.

Методы класса:
`set counter(value: number)` - сеттер для обновления счетчика товаров в корзине. При изменении значения обновляет текстовое содержимое соответствующего DOM-элемента.

#### Интерфейс IGallery
ЭИнтерфейс описывает структуру данных, используемых компонентом галереи товаров.
```
interface IGallery {
  catalog: HTMLElement;
}
```
#### Класс GalleryView
Описание:
Этот класс будет использовать композицию, чтобы выполнить запрос на сервер с помощью метода get класса Api и будет получать с сервера объект с массивом товаров.
Класс отвечает за:
- Отображение каталога товаров (массив карточек)
- Обновление каталога при получении новых данных

Поля:
Класс не содержит собственных полей, так как вся работа ведется через унаследованное свойство container базового класса Component.

Конструктор:
`constructor(container: HTMLElement)` - корневой DOM-элемент галереи товаров.
В конструкторе выполняется инициализация базового компонента без дополнительной логики.

Методы класса:
`set catalog(items: HTMLElement[])` - передает карточкии и вставляет в разметку
Сеттер для обновления содержимого галереи.
Полностью заменяет текущее содержимое контейнера галереи переданным массивом карточек товаров.


#### Интерфейс компонента ModalView
Интерфейс описывает данные, используемые модальным окном.
```
interface IModal {
    content: HTMLElement;
}
```
#### Класс ModalView
Описание:
Класс ModalView отвечает за отображение и управление модальным окном приложения.
Он инкапсулирует логику открытия и закрытия модального окна, а также отображение переданного контента.
Компонент не знает, какой именно контент он отображает (корзина, карточка товара, формы) —
он работает с любым DOM-элементом, переданным извне.

Поля:
`protected contentElement: HTMLElement` - элемент, содержащий контент модального окна
`protected closeButton: HTMLButtonElement` - кнопка закрытия модального окна

Все слушатели событий устанавливаются один раз в конструкторе класса;
О действиях пользователя класс представления уведомляет с помощью брокера событий или вызывает обработчик, полученный в конструкторе. В случае, если в класс представления передается обработчик, то этот обработчик должен содержать генерацию события с помощью брокера событий;

Конструктор:
`constructor(protected event: IEvents, container: HTMLElement) {}` - Принимает объект событий и контейнер для рендеринга.
Обработка событий.
ModalView обрабатывает следующие взаимодействия пользователя:
- Клик по фону модального окна → инициирует закрытие модального окна
- Клик по кнопке закрытия → инициирует закрытие модального окна
- Клик внутри контента → предотвращает закрытие модального окна
- При закрытии модального окна генерируется событие:
  State.MODAL_CLOSE

Методы:
`set content(value: HTMLElement)` - Сеттер для обновления содержимого модального окна без изменения его состояния (открыто / закрыто).
`openModal(value: HTMLElement): void` - Открывает модальное окно и отображает переданный контент.
`closeModal(): void` - Закрывает модальное окно, удаляя активный CSS-класс.


#### Интерфейс компонента IBasket
Интерфейс описывает данные, необходимые для отображения состояния корзины.
```
interface IBasket {
  basketList: IProduct[];
  totalPrice: number;
  emptyMessage: boolean;
}
```
#### Класс BasketView
Класс BasketView отвечает за отображение корзины пользователя.
Он управляет списком товаров в корзине, общей стоимостью заказа и кнопкой перехода к оформлению заказа.
Компонент получает данные извне через Presenter и отображает их, не храня бизнес-логику работы с корзиной.

Поля класса:
- `protected basketList: HTMLUListElement` - элемент, содержащий список товаров в корзине.
- `protected submitButton: HTMLButtonElement` - кнопка для оформления заказа.
- `protected totalPrice: HTMLElement` - элемент, отображающий общую стоимость товаров в корзине.

Конструктор:
`constructor(protected events: IEvents, container: HTMLElement) {}`
- Принимает объект событий и контейнер для рендеринга.
- Инициализирует элементы корзины и вызывает метод render для создания структуры корзины.

Обработка событий
При клике на кнопку оформления заказа BasketView:
- эмитирует событие State.BASKET_ADD_ORDERED
Само открытие формы заказа реализуется в Presenter (в main.ts).

Методы:
`set basketList(items: HTMLElement[])` - Устанавливает список товаров в корзине, заменяя текущие элементы на новые.
`set totalPrice(value: number)` - Устанавливает и отображает общую стоимость товаров в корзине.
`setButtonText(value: string): void` - Устанавливает текст на кнопке оформления заказа.
`setButtonState(isDisabled: boolean): void` - Устанавливает состояние кнопки оформления заказа (активна/неактивна).

#### Интерфейс компонента SuccessView
Интерфейс описывает данные, необходимые для отображения экрана успешного оформления заказа.
```
interface ISuccsess {
    totalPrice: number;
}
```
#### Класс компонента SuccessView
Класс SuccessView отвечает за отображение экрана успешного завершения заказа.
Он показывает пользователю информацию о списанной сумме и предоставляет кнопку для закрытия окна подтверждения.
Компонент используется после успешной отправки данных заказа и завершает пользовательский сценарий покупки.

Поля:
`protected totalPriceElement: HTMLElement` - DOM-элемент для отображения информации о списанной сумме заказа.
`protected confirmationButton: HTMLButtonElement` - Кнопка закрытия окна успешного подтверждения заказа.

Конструктор:
`constructor(protected event: IEvents, container: HTMLElement) {}` - В конструкторе: инициализируются необходимые DOM-элементы, на кнопку подтверждения навешивается обработчик клика.
Обработка событий.
При нажатии на кнопку подтверждения:
- эмитируется событие State.CONFIRMATION_CLOSE
Закрытие модального окна и очистка состояния выполняются в Presenter (main.ts).

Методы:
`set totalPrice(value: number)` - Устанавливает общую стоимость оплаченной покупки.

#### Абстрактный класс CardParentView
Описание:
CardParentView — абстрактный базовый класс для всех карточек товаров в приложении.
Класс инкапсулирует общую логику и DOM-элементы, характерные для любых карточек, независимо от их назначения.
От данного класса наследуются:
- CardImageCategoryView — карточки каталога и предпросмотра.
- CardBasketView — карточки товаров в корзине.
Класс отвечает за:
- отображение названия товара;
- отображение цены товара;
- предоставление базовой структуры карточки для дочерних компонентов.
CardParentView не содержит логики взаимодействия с пользователем и не знает о событиях приложения — вся интерактивность реализуется в наследниках.
Класс работает с моделью данных `IProduct`, получая данные о товаре через метод `render()` базового компонента `Component`.


Поля класса:
`protected priceElement: HTMLElement` - DOM-элемент для отображения цены товара.
`protected titleElement: HTMLElement` - DOM-элемент для отображения названия товара.

Конструктор класса:
`constructor(container: HTMLElement) {}` - В конструкторе: инициализируются DOM-элементы названия и цены карточки, подготавливается базовая структура карточки для дальнейшего использования в дочерних классах.

Методы класса:
`set price(value: number)` - Установить цену карточки: если цена задана — отображается числовое значение, если цена отсутствует (null) — отображается текст «Бесценно».
`set title(value: string)` - Установить заголовок карточки.


#### Класс CardImageCategoryView
Описание:
CardImageCategoryView — абстрактный класс карточек товаров с изображением и категорией.
Расширяет базовый класс CardParentView, добавляя визуальные элементы, характерные для карточек каталога и карточек предпросмотра товара.
Класс используется как промежуточный слой и не предназначен для прямого создания экземпляров.
Класс отвечает за:
- отображение изображения товара;
- отображение категории товара;
- применение CSS-классов категории в зависимости от её значения;
- формирование полного пути к изображению товара через CDN.
От данного класса наследуются:
- CardCatalogView — карточка товара в каталоге;
- CardPreviewView — карточка предпросмотра товара.
Наследует:
- отображение названия товара;
- отображение цены товара;
- базовую структуру карточки.
Дополняет карточку изображением и категорией.

Поля класса:
`protected _imageElement: HTMLImageElement` - DOM-элемент изображения карточки.
`protected _categoryElement: HTMLElement` - DOM-элемент категории товара карточки.
 
Конструктор класса:
`constructor(container: HTMLElement) {}` - вызывается конструктор родительского класса CardParentView, инициализируются DOM-элементы изображения и категории карточки.
 
Методы класса:
`set image(value: string)` - Устанавливает изображение карточки: формирует полный URL изображения с использованием CDN_URL, автоматически заменяет расширение файла на .png, присваивает полученный путь элементу <img>.
`set category(value: string)` - Устанавливает категорию товара: отображает текст категории, динамически применяет CSS-класс категории на основе categoryMap, гарантирует, что активен только класс, соответствующий текущей категории.


#### Интерфейс ICardCatalogActions
Интерфейс описывает набор возможных действий, передаваемых в карточку каталога.
```
interface ICardCatalogActions {
  onClick?: () => void;
}
```
`onClick` — обработчик клика по карточке товара.

#### Класс CardCatalogView
CardCatalogView — класс представления карточки товара в каталоге.
Является дочерним классом CardImageCategoryView и расширяет его логикой пользовательского взаимодействия — обработкой клика по карточке.
Карточка каталога представляет товар в общем списке и служит точкой входа для открытия детального просмотра товара.
Класс отвечает за:
- отображение карточки товара в каталоге;
- обработку клика по карточке;
- вызов внешнего обработчика при взаимодействии пользователя с карточкой.
Наследует от родительских классов:
- отображение названия товара;
- отображение цены товара;
- отображение изображения товара;
- отображение категории товара.

Конструктор класса:
`constructor(container: HTMLElement, actions?: ICardCatalogActions)` - вызывается конструктор родительского класса CardImageCategoryView, при наличии обработчика onClick добавляется слушатель события click на всю карточку.
Логика взаимодействия:
- карточка целиком является кликабельной;
- при клике вызывается обработчик, переданный через actions.onClick;
- класс не знает, какое событие будет вызвано — он лишь делегирует управление наружу.


#### Класс CardPreviewView
Описание класса:
CardPreviewView — класс представления карточки предпросмотра товара.
Является дочерним классом CardImageCategoryView и используется для отображения детальной информации о товаре в модальном окне.
Карточка предпросмотра позволяет пользователю:
- ознакомиться с описанием товара;
- добавить товар в корзину/ удалить товар из корзины (в зависимости от состояния).
Класс отвечает за:
- отображение подробной информации о товаре;
- отображение описания товара;
- управление состоянием кнопки действия;
- генерацию события добавления или удаления товара из корзины.
Наследует функциональность:
- отображения названия товара;
- отображения цены товара;
- отображения изображения;
- отображения категории.

Поля класса:
`protected descriptionElement: HTMLElement` - DOM-элемент с текстовым описанием товара.
`protected buttonElement: HTMLElement` - кнопка действия («Купить», «Удалить из корзины», «Недоступно»).

Конструктор класса:
`constructor(container: HTMLElement, events: IEvents) {}` - вызывается конструктор родительского класса, инициализируются DOM-элементы описания и кнопки, навешивается обработчик клика на кнопку, который эмитит событие State.BASKET_TOGGLE_ITEM.

Методы класса:
`set description(value: string)` - Устанавливает текст описания карточки.
`set buttonText(value: string)` - Устанавливает текст кнопки ("Купить", "Удалить из корзины", "Недоступно").
`toggleState(isActive: boolean): void` - Управляет доступностью кнопки действия: при false кнопка визуально отключается; используется для товаров без цены.
Логика взаимодействия
- кнопка действия всегда одна;
- логика "купить / удалить" не находится внутри класса;
- класс лишь сообщает о клике через событие;
- текущее состояние определяется презентером (main.ts).


#### Тип onRemove
Тип описывает набор действий, которые могут быть переданы в карточку корзины.
Используется для передачи обработчика удаления товара.
```
type onRemove = {
  onRemove?: () => void;
};
```
`onClick` — обработчик клика по карточке товара.

#### Класс CardBasketView
Описание:
Класс CardCardBasketView — класс представления карточки товара в корзине.
Является дочерним классом CardParentView и используется для отображения товара, добавленного в корзину, с возможностью его удаления.
Карточка отображает:
- порядковый номер товара в корзине;
- название товара;
- цену товара;
- кнопку удаления товара из корзины.
Класс отвечает за:
- визуальное отображение товара в корзине;
- отображение порядкового номера товара;
- обработку пользовательского действия по удалению товара из корзины;
- передачу события удаления наружу через callback.
Наследует функциональность:
- отображения названия товара;
- отображения цены товара.

Поля класса:
`private _deleteButtonElement: HTMLButtonElement` - Элемент кнопки удаления товара из корзины.
`private _indexElement: HTMLElement` - Элемент индекса товара в корзине.

Конструктор класса:
`constructor(container: HTMLElement, actions?: onRemove){}` - вызывается конструктор родительского класса, инициализируются DOM-элементы кнопки удаления и индекса, при наличии onRemove навешивается обработчик клика на кнопку удаления, предотвращается всплытие событий, чтобы клик не вызывал другие обработчики.

Методы класса:
`set index(value: number)` - Устанавливает порядковый номер товара в корзине.
Используется для:
- нумерации товаров;
- отображения текущего порядка элементов в корзине.
Логика взаимодействия
- класс не знает, как именно происходит удаление товара;
- при клике на кнопку удаления вызывается переданный callback onRemove;
- бизнес-логика удаления реализуется вне слоя View (в Presenter / Model).


#### Интерфейс IFormParent
Интерфейс описывает структуру данных, необходимых для базовой формы.
```
interface IFormParent {
  formErrorElement: HTMLElement;
};
```

#### Интерфейс IFormValidation
Интерфейс используется для передачи ошибок валидации.
Каждое поле содержит строку с текстом ошибки либо отсутствует, если поле валидно.
```
interface IFormValidation {
  payment?: string;
  email?: string;
  phone?: string;
  address?: string;
};
```

#### Абстрактный класс FormParentView
Описание:
FormParentView — абстрактный базовый класс для всех форм приложения.
Он инкапсулирует общую логику работы с формами: обработку отправки, отображение ошибок, валидацию и управление состоянием кнопки отправки.
Класс наследуется от базового компонента `Component` и расширяет его функциональность для работы с HTML-формами.
Класс не используется напрямую и служит основой для конкретных форм, таких как:
- форма оформления заказа;
- форма ввода контактных данных.
Класс отвечает за:
- перехват и обработку события отправки формы;
- отображение сообщений об ошибках;
- управление активностью кнопки отправки;
- предоставление общего интерфейса валидации для всех форм.

Поля класса:
`protected _formError: HTMLElement` - Элемент для отображения сообщений об ошибках формы.
`protected _submitButton: HTMLButtonElement` - кнопка отправки формы..

Конструктор класса:
`constructor(protected events: IEvents, container: HTMLElement){}` - инициализируются элементы отображения ошибок и кнопка отправки, устанавливается обработчик события `submit`, стандартное поведение формы отменяется (preventDefault), при отправке формы генерируется событие State.FORM_SUBMIT.

Методы класса:
`set formError(value: string)` - Устанавливает текст сообщения об ошибке формы.
`abstract formValidation(error: IFormValidation): boolean` - Абстрактный метод валидации формы.
Должен быть реализован в дочерних классах и возвращать: true, если форма валидна; false, если обнаружены ошибки.
`clearErrorMessages(): void` - Очищает сообщения об ошибках формы.
`setSubmitEnabled(isEnabled: boolean): void` - Управляет состоянием кнопки отправки: активирует кнопку, если isEnabled === true; блокирует кнопку, если isEnabled === false.
`toggleErrorClass(value: boolean): void` - Добавляет или удаляет CSS-класс form__errors-active у блока ошибок.
`resetForm(): void` - Сбрасывает состояние формы: очищает сообщения об ошибках; блокирует кнопку отправки.

Логика взаимодействия
- FormParentView не выполняет валидацию самостоятельно;
- логика валидации передаётся в дочерние классы;
- все действия пользователя транслируются через систему событий;
- класс не хранит данные формы, а только отображает состояние.


#### Класс FormOrderView
Описание:
FormOrderView — класс представления формы оформления заказа.
Он отвечает за выбор способа оплаты, ввод адреса доставки и валидацию этих данных.
Класс наследуется от FormParentView и расширяет его функциональность логикой, специфичной для первого шага оформления заказа.
Класс наследует базовую логику работы с формами:
- обработку отправки формы;
- управление кнопкой отправки;
- отображение ошибок валидации.

Поля класса:
`private _paymentByCard: HTMLButtonElement` - кнопка выбора оплаты банковской картой.
`private _cashPayment: HTMLButtonElement` - кнопка выбора оплаты наличными.
`private _addressInput: HTMLInputElement` - поле ввода адреса доставки.

Конструктор:
`constructor(protected events: IEvents, container: HTMLElement)` - инициализируются элементы управления формой, регистрируются обработчики пользовательских событий, при выборе способа оплаты генерируется событие State.FORM_PAYMENT_CHANGED, при изменении адреса доставки генерируется событие State.FORM_ADDRESS_CHANGED, при нажатии на кнопку отправки генерируется событие State.FORM_SUBMIT_ORDER.

Методы класса
`formValidation(error: IFormValidation): boolean` - Выполняет валидацию формы заказа.
Логика работы:
- очищает предыдущие сообщения об ошибках;
-отображает ошибку, связанную с оплатой или адресом;
- возвращает true, если оба поля валидны;
- возвращает false, если обнаружены ошибки.
`resetForm(): void` - Сбрасывает состояние формы заказа: вызывает сброс базовой формы (super.resetForm()), очищает сообщения об ошибках, снимает визуальное выделение выбранного способа оплаты.
`togglePaymentStatus(status: TPayment): void` - Отображает выбранный способ оплаты. Метод добавляет или удаляет CSS-класс button_alt-active у соответствующих кнопок.
`clearAderessInput(): void` - Очищает поле ввода адреса доставки.

Логика взаимодействия
- FormOrderView не хранит данные формы;
- все изменения передаются во внешний слой через события;
- валидация выполняется на основе данных из модели Buyer;
- состояние кнопки отправки управляется извне (через Presenter).

#### Класс FormContactView
Описание:
FormContactView — класс представления формы контактных данных покупателя.
Он отвечает за ввод и валидацию контактной информации пользователя (email и телефон) на втором шаге оформления заказа.
Класс наследуется от FormParentView и использует общую инфраструктуру форм: обработку отправки, отображение ошибок и управление кнопкой отправки.
Класс отвечает за:
- ввод email пользователя;
- ввод номера телефона;
- валидацию контактных данных;
- генерацию событий при изменении полей формы;
- отправку контактных данных для завершения оформления заказа.
Класс наследует:
- обработку события submit;
- управление состоянием кнопки отправки;
- отображение сообщений об ошибках;
- методы сброса состояния формы.

Поля класса:
`private _email: HTMLInputElement` — поле ввода адреса электронной почты пользователя.
`private _phone: HTMLInputElement` — поле ввода номера телефона пользователя.

Конструктор:
`constructor(events: IEvents, container: HTMLElement)` - инициализируются поля ввода email и телефона, устанавливаются обработчики событий input для передачи данных в модель, при нажатии кнопки отправки генерируется событие State.FORM_CONTACTS_ADD.

Методы класса:
`formValidation(error: IFormValidation): boolean` - Проверяет корректность введённых контактных данных.
`clearPhoneEmailFields(): void` - Очищает поля ввода email и телефона.
`resetForm(): void` - Сбрасывает состояние формы контактов: вызывает базовый метод resetForm() родительского класса, очищает поля email и телефона, приводит форму в начальное состояние.

Логика взаимодействия
- FormContactView не хранит состояние данных;
- любые изменения полей передаются во внешний слой через события;
- проверка валидности данных выполняется на основе модели Buyer;
- кнопка отправки активируется и деактивируется Presenter’ом.

### Слой Presenter (main.ts)
Слой Presenter отвечает за связывание моделей и представлений, управление потоком данных и обработку пользовательских событий.
В данном проекте Presenter реализован в файле main.ts и построен на событийной архитектуре с использованием брокера событий (EventEmitter).
Presenter:
- не содержит DOM-разметки;
- не хранит состояние;
- реагирует на события View;
- обновляет Model;
- передаёт данные обратно во View.

#### Общая архитектура Presenter
Presenter реализует паттерн Mediator:
- все компоненты (View и Model) общаются не напрямую, а через события;
- main.ts подписывается на события и координирует логику приложения.

#### Инициализация данных
Загрузка товаров с сервера:
```
shopApi.getProducts()
    .then(data => { productsModel.setItems(data) })
    .catch((err) => console.log('Ошибка при получении данных с сервера: ', err));
```
Presenter:
- запрашивает список товаров у API;
- передаёт данные в модель Products;
- в случае ошибки логирует её.
После обновления модели инициируется событие обновления каталога.

#### Формирование данных заказа
Функция buildOrderData: 
```
function buildOrderData() {
    return {
        payment: buyerModel.getData().payment,
        address: buyerModel.getData().address,
        email: buyerModel.getData().email,
        phone: buyerModel.getData().phone,
        items: basketModel.getItems().map(item => item.id),
        total: basketModel.getTotalPrice(),
    };
}
```
Назначение:
- агрегирует данные из разных моделей (Buyer, Basket);
- формирует объект заказа в формате, ожидаемом сервером;
- используется перед отправкой заказа.

#### События каталога (Catalog)
Обновление каталога товаров:
`events.on(State.CATALOG_UPDATE_SET_ITEMS, () => { ... });` - получает список товаров из Products; создаёт карточки CardCatalogView; передаёт готовые элементы в GalleryView.

Открытие карточки товара:
`events.on(State.CATALOG_OPEN, (data: { id: string }) => { ... });` - получает id товара; устанавливает выбранный товар в модель Products.

Отображение превью товара:
`events.on(State.CATALOG_UPDATE_SET_SELECTED_ITEM, () => { ... });` - формирует карточку предпросмотра; определяет состояние кнопки («Купить», «Удалить», «Недоступно»); открывает модальное окно с превью.

#### Работа с корзиной (Basket)
Добавление / удаление товара:
`events.on(State.BASKET_TOGGLE_ITEM, () => { ... });` - проверяет наличие товара в корзине; добавляет или удаляет товар; закрывает модальное окно.

Открытие корзины:
`events.on(State.BASKET_OPEN, () => { ... });` - отображает корзину в модальном окне; управляет активностью кнопки оформления заказа.

Обновление корзины: 
`events.on(State.BASKET_CHANGED, (data) => { ... });` - пересобирает список карточек корзины; обновляет: счётчик в HeaderView, список товаров, общую стоимость, состояние кнопки оформления.

Удаление товара из корзины: 
`events.on(State.BASKET_REMOVE, (product) => { ... }); `- удаляет товар из модели Basket по id.

#### Оформление заказа (Forms)
Открытие формы заказа:
`events.on(State.BASKET_ADD_ORDERED, () => { ... });` - отображает форму выбора оплаты и адреса доставки.

Обработка формы заказа:
`events.on(State.FORM_PAYMENT_CHANGED, ...)`
`events.on(State.FORM_ADDRESS_CHANGED, ...)`
Presenter:
- обновляет модель Buyer;
- запускает валидацию;
- управляет состоянием кнопки «Далее»;
- синхронизирует UI формы.

Переход к форме контактов:
`events.on(State.FORM_SUBMIT_ORDER, () => { ... });` - открывает форму ввода email и телефона.

Обработка формы контактов:
`events.on(State.FORM_EMAIL_CHANGED, ...)`
`events.on(State.FORM_PHONE_CHANGED, ...)`
Presenter:
- обновляет данные покупателя;
- валидирует поля;
- управляет кнопкой отправки.

#### Отправка заказа на сервер
`events.on(State.FORM_CONTACTS_ADD, async () => { ... });` - собирает данные заказа, отправляет заказ через ShopApi, обрабатывает успешный ответ, 
очищает модели, отображает экран успешного оформления заказа.

#### Завершение сценария
`events.on(State.CONFIRMATION_CLOSE, () => { ... });` - закрывает модальное окно, сбрасывает формы, возвращает приложение в начальное состояние.